function Pacman(a,b,c){this.x=a,this.y=b,this.dir=c,this.nextDir=void 0,this.radius=PACMAN_RADIUS,this.mouthOpen=!0}function Ghost(a,b,c,d){this.x=a,this.y=b,this.color=c,this.dir=d,this.isWeak=!1,this.radius=GHOST_RADIUS,this.isMoving=!1,this.isBlinking=!1,this.isDead=!1,this.speed=speed,this.stepCounter=0}function Grid(a,b,c,d){this.x=a,this.y=b,this.gridType=void 0===c?EMPTY_GRID:c,this.beanType=d}function initCanvas(a,b){void 0!==a&&a instanceof Number||(a=CANVAS_WIDTH),void 0!==b&&b instanceof Number||(b=CANVAS_HEIGHT),ctx.fillStyle="#F7F7F7",ctx.fillRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT)}function initMaze(){for(var a=0;a<maze.length;a++){var b=new Array(CANVAS_WIDTH/GRID_WIDTH);maze[a]=b}for(var c=0;c<CANVAS_HEIGHT/GRID_HEIGHT;c++)for(var d=0;d<CANVAS_WIDTH/GRID_WIDTH;d++){var e=NORMAL_BEAN,f=new Grid(d*GRID_WIDTH,c*GRID_HEIGHT,mazeContent[c][d],e);maze[c][d]=f,f.draw()}for(var a=0;a<noBean.length;a++){var g=noBean[a][0],h=noBean[a][1];maze[g][h].beanType=void 0,maze[g][h].draw()}for(var a=0;a<powerBeans.length;a++){var g=powerBeans[a][0],h=powerBeans[a][1];maze[g][h].beanType=POWER_BEAN,maze[g][h].draw()}}function initFields(){for(var a=6;a<10;a++)ghostHouse[ghostHouseIndex]=[a,9],ghostHouseIndex++;for(var a=0;a<2;a++)for(var b=8;b<17;b++)staticGrids[staticGridsIndex]=[a,b],staticGridsIndex++;for(var a=9;a<17;a++)for(var b=0;b<4;b++)staticGrids[staticGridsIndex]=[a,b],staticGridsIndex++;for(var a=2;a<6;a++)for(var b=14;b<17;b++)staticGrids[staticGridsIndex]=[a,b],staticGridsIndex++;for(var a=0;a<2;a++)for(var b=8;b<17;b++)noBean[noBeanIndex]=[a,b],noBeanIndex++;for(var a=2;a<6;a++)for(var b=14;b<17;b++)noBean[noBeanIndex]=[a,b],noBeanIndex++;for(var a=9;a<17;a++)for(var b=0;b<4;b++)noBean[noBeanIndex]=[a,b],noBeanIndex++;for(var a=1;a<6;a++)noBean[noBeanIndex]=[a,2],noBeanIndex++;for(var a=1;a<4;a+=2)for(var b=4;b<7;b++)noBean[noBeanIndex]=[a,b],noBeanIndex++;for(var b=8;b<13;b++)noBean[noBeanIndex]=[3,b],noBeanIndex++;for(var b=1;b<7;b++)noBean[noBeanIndex]=[7,b],noBeanIndex++;for(var a=5;a<10;a++)for(var b=8;b<11;b++)noBean[noBeanIndex]=[a,b],noBeanIndex++;for(var b=12;b<16;b++)noBean[noBeanIndex]=[7,b],noBeanIndex++;for(var b=12;b<16;b++)noBean[noBeanIndex]=[9,b],noBeanIndex++;for(var a=11;a<16;a+=2)for(var b=5;b<8;b++)noBean[noBeanIndex]=[a,b],noBeanIndex++;for(var a=11;a<16;a+=2)for(var b=9;b<12;b++)noBean[noBeanIndex]=[a,b],noBeanIndex++;for(var b=13;b<16;b++)noBean[noBeanIndex]=[11,b],noBeanIndex++;for(var a=12;a<16;a++)noBean[noBeanIndex]=[a,15],noBeanIndex++;for(var a=13;a<17;a++)noBean[noBeanIndex]=[a,13],noBeanIndex++}function circle(a,b,c,d){a.beginPath(),a.arc(b,c,d,0,2*Math.PI,!0),a.fill()}function oppositeDir(a){switch(a){case UP:return DOWN;case DOWN:return UP;case LEFT:return RIGHT;case RIGHT:return LEFT;default:return-1}}function getRowIndex(a){return void 0===a?-1:parseInt(a/GRID_HEIGHT)}function getColIndex(a){return void 0===a?-1:parseInt(a/GRID_WIDTH)}function sleep(a){var b=new Date;for(b.setTime(b.getTime()+a);(new Date).getTime()<b.getTime(););}function fixGrids(a,b){var c=getRowIndex(b),d=getColIndex(a);xOnGridCenter(b)?(maze[c][d].draw(),d+1<maze.length&&!staticArrayContains([c,d+1])&&maze[c][d+1].draw(),d-1>=0&&!staticArrayContains([c,d-1])&&maze[c][d-1].draw()):yOnGridCenter(a)&&(maze[c][d].draw(),c+1<maze.length&&!staticArrayContains([c+1,d])&&maze[c+1][d].draw(),c-1>=0&&!staticArrayContains([c-1,d])&&maze[c-1][d].draw())}function staticArrayContains(a){for(var b=a[0],c=a[1],d=0;d<staticGrids.length;d++)if(b===staticGrids[d][0]&&c===staticGrids[d][1])return!0;return!1}function ghostHouseContains(a){for(var b=a[0],c=a[1],d=0;d<ghostHouse.length;d++)if(b===ghostHouse[d][0]&&c===ghostHouse[d][1])return!0;return!1}function onGridCenter(a,b){return xOnGridCenter(b)&&yOnGridCenter(a)}function xOnGridCenter(a){return(a-GRID_WIDTH/2)%GRID_WIDTH===0}function yOnGridCenter(a){return(a-GRID_HEIGHT/2)%GRID_HEIGHT===0}function canMove(a,b,c){if(!onGridCenter(a,b))return!0;var d=!1,e=maze[getRowIndex(b)][getColIndex(a)],f=e.gridType;switch(c){case UP:f!=LEFT_TOP&&f!=RIGHT_TOP&&f!=TOP_BOTTOM&&f!=TOP_ONLY&&f!=LEFT_TOP_RIGHT&&f!=TOP_RIGHT_BOTTOM&&f!=BOTTOM_LEFT_TOP&&(d=!0);break;case DOWN:f!=LEFT_BOTTOM&&f!=TOP_BOTTOM&&f!=RIGHT_BOTTOM&&f!=BOTTOM_ONLY&&f!=RIGHT_BOTTOM_LEFT&&f!=BOTTOM_LEFT_TOP&&f!=TOP_RIGHT_BOTTOM&&(d=!0);break;case LEFT:f!=LEFT_BOTTOM&&f!=LEFT_TOP&&f!=LEFT_ONLY&&f!=LEFT_RIGHT&&f!=LEFT_TOP_RIGHT&&f!=BOTTOM_LEFT_TOP&&f!=RIGHT_BOTTOM_LEFT&&(d=!0);break;case RIGHT:f!=RIGHT_BOTTOM&&f!=RIGHT_TOP&&f!=RIGHT_ONLY&&f!=LEFT_RIGHT&&f!=RIGHT_BOTTOM_LEFT&&f!=TOP_RIGHT_BOTTOM&&f!=LEFT_TOP_RIGHT&&(d=!0)}return d}function printInstruction(){ctx.fillStyle="white",ctx.font="12px monospace",ctx.textAlign="left";for(var a="WELCOME TO \nPACMAN 15-237!\n\n\nArrow keys or\nWASD to move\n\nQ to pause\nE to resume\nR to restart",b=12,c=CANVAS_HEIGHT-200,d=15,e=a.split("\n"),f=0;f<e.length;f++)ctx.fillText(e[f],b,c+f*d);0===ghosts.length&&(ctx.fillStyle="#F7F7F7",ctx.fillRect(b,CANVAS_WIDTH-40,70,30),ctx.fillStyle="#FA2A00",ctx.font="16px monospace",ctx.textAlign="left",ctx.fillText("GOD MODE",b,CANVAS_WIDTH-20))}function showLives(){ctx.fillStyle="#F7F7F7",ctx.fillRect(CANVAS_WIDTH-80,10,70,30);for(var a=0;a<life-1;a++)lives[a]=new Pacman(CANVAS_WIDTH-50+25*a,30,RIGHT),lives[a].draw()}function welcomeScreen(){gameOn=!1,gamePaused=!1,ctx.fillStyle="Black",ctx.font="80px monospace",ctx.textAlign="center",ctx.fillText("CAPITO",CANVAS_WIDTH/2,170),ctx.font="20px monospace",ctx.fillText("Press s to start",CANVAS_WIDTH/2,220),ctx.font="14px monospace",welcomePacman=new Pacman(CANVAS_WIDTH/5,CANVAS_HEIGHT/3*2,RIGHT),welcomePacman.radius=30,welcomePacman.draw(),welcomeBlinky=new Ghost(CANVAS_WIDTH/5*3.3,CANVAS_HEIGHT/3*2,RED,LEFT),welcomeBlinky.radius=30,welcomeBlinky.draw(),welcomeInky=new Ghost(CANVAS_WIDTH/5*4,CANVAS_HEIGHT/3*2,CYAN,RIGHT),welcomeInky.radius=30,welcomeInky.draw(),intervalId=setInterval(updateWelcomeScreen,2*timerDelay)}function updateWelcomeScreen(){ctx.fillStyle="#F7F7F7",ctx.fillRect(0,CANVAS_HEIGHT/2,CANVAS_WIDTH,140),welcomePacman.mouthOpen=!welcomePacman.mouthOpen,welcomeBlinky.isMoving=!welcomeBlinky.isMoving,welcomeInky.isMoving=!welcomeInky.isMoving,welcomePacman.draw(),welcomeInky.draw(),welcomeBlinky.draw()}function showScore(){ctx.fillStyle="#F7F7F7",ctx.fillRect(CANVAS_WIDTH-250,10,190,40),ctx.fillStyle="black",ctx.font="24px monospace",ctx.textAlign="left",ctx.fillText("score: "+parseInt(score),CANVAS_WIDTH-250,37)}function winMessage(){ctx.fillStyle="#F7F7F7",ctx.strokeStyle="#1ABC9C",ctx.lineWidth=5,ctx.fillRect(CANVAS_WIDTH/2-150,CANVAS_HEIGHT/2-40,300,100),ctx.strokeRect(CANVAS_WIDTH/2-150,CANVAS_HEIGHT/2-40,300,100),ctx.textAlign="center",ctx.fillStyle="white",ctx.font="16px monospace",ctx.fillText("Congratulations, you won!",CANVAS_HEIGHT/2,CANVAS_HEIGHT/2+6),ctx.font="12px monospace",ctx.fillText("press R to play again",CANVAS_HEIGHT/2,CANVAS_HEIGHT/2+28)}function loseMessage(){ctx.fillStyle="#F7F7F7",ctx.strokeStyle="#FA2A00",ctx.lineWidth=5,ctx.fillRect(CANVAS_WIDTH/2-100,CANVAS_HEIGHT/2-40,200,100),ctx.strokeRect(CANVAS_WIDTH/2-100,CANVAS_HEIGHT/2-40,200,100),ctx.textAlign="center",ctx.fillStyle="#FA2A00",ctx.font="26px monospace",ctx.fillText("GAME OVER",CANVAS_HEIGHT/2,CANVAS_HEIGHT/2+7),ctx.font="12px monospace",ctx.fillText("press R to play again",CANVAS_HEIGHT/2,CANVAS_HEIGHT/2+28)}function updateCanvas(){if(restartTimer++,gameOver()===!0)if(life--,showLives(),life>0){sleep(500),clearInterval(intervalId),fixGrids(mrPacman.x,mrPacman.y);for(var a=0;a<ghosts.length;a++)fixGrids(ghosts[a].x,ghosts[a].y);run()}else clearInterval(intervalId),sleep(500),loseMessage();else if(pacmanWon()===!0)clearInterval(intervalId),sleep(500),winMessage();else{if(weakCounter>0&&weakCounter<2e3/timerDelay)for(var a=0;a<ghosts.length;a++)ghosts[a].isBlinking=!ghosts[a].isBlinking;if(weakCounter>0&&weakCounter--,0===weakCounter)for(var a=0;a<ghosts.length;a++)ghosts[a].isDead=!1,ghosts[a].isWeak=!1,ghosts[a.isBlinking=!1],weakBonus=200;eatBean(),eatGhost(),mrPacman.move();for(var a=0;a<ghosts.length;a++)ghosts[a].isDead===!1&&ghosts[a].move();fixGrids(mrPacman.x,mrPacman.y);for(var a=0;a<ghosts.length;a++)fixGrids(ghosts[a].x,ghosts[a].y);mrPacman.draw();for(var a=0;a<ghosts.length;a++)ghosts[a].draw()}}function eatBean(){if(onGridCenter(mrPacman.x,mrPacman.y)){if(maze[mrPacman.getRow()][mrPacman.getCol()].beanType===NORMAL_BEAN)score+=parseInt(10),showScore(),beansLeft--;else if(maze[mrPacman.getRow()][mrPacman.getCol()].beanType===POWER_BEAN){score+=parseInt(50),showScore(),beansLeft--;for(var a=0;a<ghosts.length;a++)ghosts[a].isWeak=!0;weakCounter=WEAK_DURATION}maze[mrPacman.getRow()][mrPacman.getCol()].beanType=void 0,maze[mrPacman.getRow()][mrPacman.getCol()].draw()}}function eatGhost(){for(var a=0;a<ghosts.length;a++)Math.abs(mrPacman.x-ghosts[a].x)<=5&&Math.abs(mrPacman.y-ghosts[a].y)<=5&&ghosts[a].isWeak&&!ghosts[a].isDead&&(score+=parseInt(weakBonus),weakBonus*=2,showScore(),ghosts[a].isDead=!0,ghosts[a].toGhostHouse())}function gameOver(){for(var a=0;a<ghosts.length;a++)if(Math.abs(mrPacman.x-ghosts[a].x)<=5&&Math.abs(mrPacman.y-ghosts[a].y)<=5&&!ghosts[a].isWeak)return!0;return!1}function pacmanWon(){return 0===beansLeft}function countDown(){ctx.fillStyle="#F7F7F7",ctx.fillRect(CANVAS_HEIGHT-85,70,80,80),ctx.fillStyle="#FA2A00",ctx.font="50px monospace",ctx.textAlign="center",ctx.fillText("3",CANVAS_HEIGHT-43,130),setTimeout(function(){ctx.fillStyle="#F7F7F7",ctx.fillRect(CANVAS_HEIGHT-85,70,80,80),ctx.fillStyle="orange",ctx.fillText("2",CANVAS_HEIGHT-43,130),setTimeout(function(){ctx.fillStyle="#F7F7F7",ctx.fillRect(CANVAS_HEIGHT-85,70,80,80),ctx.fillStyle="#ffb400",ctx.fillText("1",CANVAS_HEIGHT-43,130),setTimeout(function(){ctx.fillStyle="#F7F7F7",ctx.fillRect(CANVAS_HEIGHT-85,70,80,80),ctx.fillStyle="#1ABC9C",ctx.textAlign="center",ctx.fillText("GO",CANVAS_HEIGHT-43,130),setTimeout(function(){intervalId=setInterval(updateCanvas,timerDelay)},500)},1e3)},1e3)},1e3)}function onKeyDown(a){var b=a.keyCode,c=81,d=69,e=82,f=71,g=87,h=65,i=83,j=68,k=37,l=38,m=39,n=40;if(gameOn){if(b===c&&!gamePaused)return clearInterval(intervalId),void(gamePaused=!0);if(b===d&&gamePaused)return intervalId=setInterval(updateCanvas,timerDelay),void(gamePaused=!1);switch(b===e&&restartTimer>0&&(restartTimer=0,clearInterval(intervalId),gameOn=!0,gamePaused=!1,score=0,life=MAX_LIFE,beansLeft=MAX_BEANS,initMaze(),run()),b){case l:case g:mrPacman.nextDir=mrPacman.dir===UP?void 0:UP;break;case m:case j:mrPacman.nextDir=mrPacman.dir===RIGHT?void 0:RIGHT;break;case k:case h:mrPacman.nextDir=mrPacman.dir===LEFT?void 0:LEFT;break;case n:case i:mrPacman.nextDir=mrPacman.dir===DOWN?void 0:DOWN}}else{if(b===i)return clearInterval(intervalId),gameOn=!0,gamePaused=!1,initMaze(),void run();if(b===f)return clearInterval(intervalId),ghosts=[],gameOn=!0,gamePaused=!1,initMaze(),void run(!0)}}function run(a){showScore(),mrPacman=new Pacman(pacmanStartLoc[1]*GRID_WIDTH+GRID_WIDTH/2,pacmanStartLoc[0]*GRID_HEIGHT+GRID_HEIGHT/2,RIGHT),void 0!==a&&a?ghosts=[]:(blinky=new Ghost(0,0,RED,DOWN),inky=new Ghost(0,0,CYAN,DOWN),pinky=new Ghost(0,0,PINK,DOWN),clyde=new Ghost(0,0,ORANGE,DOWN),blinky.toGhostHouse(),inky.toGhostHouse(),pinky.toGhostHouse(),clyde.toGhostHouse(),ghosts=[blinky,inky,pinky,clyde],inky.draw(),blinky.draw(),pinky.draw(),clyde.draw()),showLives(),printInstruction(),mrPacman.draw(),countDown()}Pacman.prototype.draw=function(a){if(void 0==a?ctx.fillStyle=PACMAN_COLOR:ctx.fillStyle=a,ctx.beginPath(),this.mouthOpen)switch(this.dir){case UP:ctx.arc(this.x,this.y,this.radius,2*Math.PI-7*Math.PI/9,2*Math.PI-2*Math.PI/9,!0);break;case DOWN:ctx.arc(this.x,this.y,this.radius,2*Math.PI-16*Math.PI/9,2*Math.PI-11*Math.PI/9,!0);break;case LEFT:ctx.arc(this.x,this.y,this.radius,2*Math.PI-23*Math.PI/18,2*Math.PI-13*Math.PI/18,!0);break;case RIGHT:ctx.arc(this.x,this.y,this.radius,2*Math.PI-5*Math.PI/18,2*Math.PI-31*Math.PI/18,!0)}else switch(this.dir){case UP:ctx.arc(this.x,this.y,this.radius,2*Math.PI-11*Math.PI/18,2*Math.PI-7*Math.PI/18,!0);break;case DOWN:ctx.arc(this.x,this.y,this.radius,2*Math.PI-29*Math.PI/18,2*Math.PI-25*Math.PI/18,!0);break;case LEFT:ctx.arc(this.x,this.y,this.radius,2*Math.PI-10*Math.PI/9,2*Math.PI-8*Math.PI/9,!0);break;case RIGHT:ctx.arc(this.x,this.y,this.radius,2*Math.PI-Math.PI/9,2*Math.PI-17*Math.PI/9,!0)}ctx.lineTo(this.x,this.y),ctx.fill()},Pacman.prototype.getRow=function(){return getRowIndex(this.y)},Pacman.prototype.getCol=function(){return getColIndex(this.x)},Pacman.prototype.canMove=function(a){return canMove(this.x,this.y,a)},Pacman.prototype.move=function(){return onGridCenter(this.x,this.y)===!1?(void 0!=this.nextDir&&(this.dir===UP&&this.nextDir===DOWN||this.dir===DOWN&&this.nextDir===UP||this.dir===LEFT&&this.nextDir===RIGHT||this.dir===RIGHT&&this.nextDir===LEFT)&&(this.dir=this.nextDir,this.nextDir=void 0),void this.moveOneStep()):void(void 0!=this.nextDir&&this.canMove(this.nextDir)?(this.dir=this.nextDir,this.nextDir=void 0,this.moveOneStep()):this.canMove(this.dir)&&this.moveOneStep())},Pacman.prototype.moveOneStep=function(){var a=0,b=0;if(canMove(this.x,this.y,this.dir))switch(this.dir){case UP:b=this.y-speed,b-this.radius-WALL_WIDTH>0&&(this.y=b,this.mouthOpen=!this.mouthOpen);break;case DOWN:b=this.y+speed,b+this.radius+WALL_WIDTH<CANVAS_HEIGHT&&(this.y=b,this.mouthOpen=!this.mouthOpen);break;case LEFT:a=this.x-speed,a-this.radius-WALL_WIDTH>0&&(this.x=a,this.mouthOpen=!this.mouthOpen);break;case RIGHT:a=this.x+speed,a+this.radius+WALL_WIDTH<CANVAS_WIDTH&&(this.x=a,this.mouthOpen=!this.mouthOpen)}},Ghost.prototype.toGhostHouse=function(){var a,b;switch(this.color){case ORANGE:a=ghostHouse[0][1]*GRID_WIDTH+GRID_WIDTH/2,b=ghostHouse[0][0]*GRID_WIDTH+GRID_WIDTH/2;break;case CYAN:a=ghostHouse[1][1]*GRID_WIDTH+GRID_WIDTH/2,b=ghostHouse[1][0]*GRID_WIDTH+GRID_WIDTH/2;break;case PINK:a=ghostHouse[2][1]*GRID_WIDTH+GRID_WIDTH/2,b=ghostHouse[2][0]*GRID_WIDTH+GRID_WIDTH/2;break;case RED:a=ghostHouse[3][1]*GRID_WIDTH+GRID_WIDTH/2,b=ghostHouse[3][0]*GRID_WIDTH+GRID_WIDTH/2}this.x=a,this.y=b,this.dir=DOWN,this.stepCounter=0},Ghost.prototype.draw=function(){if(this.isDead||(this.isWeak?this.isBlinking?ctx.fillStyle=BLINKING_COLOR:ctx.fillStyle=WEAK_COLOR:ctx.fillStyle=this.color,ctx.beginPath(),ctx.arc(this.x,this.y,this.radius,Math.PI,0,!1),ctx.moveTo(this.x-this.radius,this.y),this.isMoving?(ctx.lineTo(this.x-this.radius,this.y+this.radius-this.radius/4),ctx.lineTo(this.x-this.radius+this.radius/3,this.y+this.radius),ctx.lineTo(this.x-this.radius+this.radius/3*2,this.y+this.radius-this.radius/4),ctx.lineTo(this.x,this.y+this.radius),ctx.lineTo(this.x+this.radius/3,this.y+this.radius-this.radius/4),ctx.lineTo(this.x+this.radius/3*2,this.y+this.radius),ctx.lineTo(this.x+this.radius,this.y+this.radius-this.radius/4),ctx.lineTo(this.x+this.radius,this.y)):(ctx.lineTo(this.x-this.radius,this.y+this.radius),ctx.lineTo(this.x-this.radius+this.radius/3,this.y+this.radius-this.radius/4),ctx.lineTo(this.x-this.radius+this.radius/3*2,this.y+this.radius),ctx.lineTo(this.x,this.y+this.radius-this.radius/4),ctx.lineTo(this.x+this.radius/3,this.y+this.radius),ctx.lineTo(this.x+this.radius/3*2,this.y+this.radius-this.radius/4),ctx.lineTo(this.x+this.radius,this.y+this.radius),ctx.lineTo(this.x+this.radius,this.y)),ctx.fill()),this.isWeak)this.isBlinking?(ctx.fillStyle="#f00",ctx.strokeStyle="f00"):(ctx.fillStyle="white",ctx.strokeStyle="white"),ctx.beginPath(),ctx.arc(this.x-this.radius/2.5,this.y-this.radius/5,this.radius/5,0,2*Math.PI,!0),ctx.fill(),ctx.beginPath(),ctx.arc(this.x+this.radius/2.5,this.y-this.radius/5,this.radius/5,0,2*Math.PI,!0),ctx.fill(),ctx.beginPath(),ctx.lineWidth=1,ctx.moveTo(this.x-this.radius+this.radius/5,this.y+this.radius/2),ctx.lineTo(this.x-this.radius+this.radius/3,this.y+this.radius/4),ctx.lineTo(this.x-this.radius+this.radius/3*2,this.y+this.radius/2),ctx.lineTo(this.x,this.y+this.radius/4),ctx.lineTo(this.x+this.radius/3,this.y+this.radius/2),ctx.lineTo(this.x+this.radius/3*2,this.y+this.radius/4),ctx.lineTo(this.x+this.radius-this.radius/5,this.y+this.radius/2),ctx.stroke();else switch(ctx.fillStyle="white",ctx.beginPath(),ctx.arc(this.x-this.radius/2.5,this.y-this.radius/5,this.radius/3,0,2*Math.PI,!0),ctx.fill(),ctx.fillStyle="white",ctx.beginPath(),ctx.arc(this.x+this.radius/2.5,this.y-this.radius/5,this.radius/3,0,2*Math.PI,!0),ctx.fill(),this.dir){case UP:ctx.fillStyle="black",ctx.beginPath(),ctx.arc(this.x-this.radius/3,this.y-this.radius/5-this.radius/6,this.radius/6,0,2*Math.PI,!0),ctx.fill(),ctx.fillStyle="black",ctx.beginPath(),ctx.arc(this.x+this.radius/3,this.y-this.radius/5-this.radius/6,this.radius/6,0,2*Math.PI,!0),ctx.fill();break;case DOWN:ctx.fillStyle="black",ctx.beginPath(),ctx.arc(this.x-this.radius/3,this.y-this.radius/5+this.radius/6,this.radius/6,0,2*Math.PI,!0),ctx.fill(),ctx.fillStyle="black",ctx.beginPath(),ctx.arc(this.x+this.radius/3,this.y-this.radius/5+this.radius/6,this.radius/6,0,2*Math.PI,!0),ctx.fill();break;case LEFT:ctx.fillStyle="black",ctx.beginPath(),ctx.arc(this.x-this.radius/3-this.radius/5,this.y-this.radius/5,this.radius/6,0,2*Math.PI,!0),ctx.fill(),ctx.fillStyle="black",ctx.beginPath(),ctx.arc(this.x+this.radius/3-this.radius/15,this.y-this.radius/5,this.radius/6,0,2*Math.PI,!0),ctx.fill();break;case RIGHT:ctx.fillStyle="black",ctx.beginPath(),ctx.arc(this.x-this.radius/3+this.radius/15,this.y-this.radius/5,this.radius/6,0,2*Math.PI,!0),ctx.fill(),ctx.fillStyle="black",ctx.beginPath(),ctx.arc(this.x+this.radius/3+this.radius/5,this.y-this.radius/5,this.radius/6,0,2*Math.PI,!0),ctx.fill()}},Ghost.prototype.getRow=function(){return getRowIndex(this.y)},Ghost.prototype.getCol=function(){return getColIndex(this.x)},Ghost.prototype.moveOneStep=function(){var a=0,b=0;if(canMove(this.x,this.y,this.dir))switch(this.dir){case UP:b=this.y-this.speed,b-this.radius-WALL_WIDTH>0&&(this.y=b);break;case DOWN:b=this.y+this.speed,b+this.radius+WALL_WIDTH<CANVAS_HEIGHT&&(this.y=b);break;case LEFT:a=this.x-this.speed,a-this.radius-WALL_WIDTH>0&&(this.x=a);break;case RIGHT:a=this.x+this.speed,a+this.radius+WALL_WIDTH<CANVAS_WIDTH&&(this.x=a)}},Ghost.prototype.turnBack=function(){this.dir=oppositeDir(this.dir)},Ghost.prototype.move=function(){if(this.isMoving=!this.isMoving,this.isWeak){if(this.speed=speed/2,weakCounter===WEAK_DURATION&&(this.dir=oppositeDir(this.dir)),onGridCenter(this.x,this.y)===!1)this.moveOneStep();else{var a=maze[getRowIndex(this.y)][getColIndex(this.x)];a.gridType===LEFT_TOP_RIGHT?(this.dir=DOWN,this.moveOneStep()):a.gridType===TOP_RIGHT_BOTTOM?(this.dir=LEFT,this.moveOneStep()):a.gridType===RIGHT_BOTTOM_LEFT?(this.dir=UP,this.moveOneStep()):a.gridType===BOTTOM_LEFT_TOP?(this.dir=RIGHT,this.moveOneStep()):this.randomMove()}this.stepCounter++}else if(0!=this.stepCounter&&this.stepCounter%2!=0?(this.speed=speed/2,this.stepCounter=0):this.speed=speed,onGridCenter(this.x,this.y)===!1)this.moveOneStep();else{var a=maze[getRowIndex(this.y)][getColIndex(this.x)];if(a.gridType===LEFT_TOP_RIGHT)this.dir=DOWN,this.moveOneStep();else if(a.gridType===TOP_RIGHT_BOTTOM)this.dir=LEFT,this.moveOneStep();else if(a.gridType===RIGHT_BOTTOM_LEFT)this.dir=UP,this.moveOneStep();else if(a.gridType===BOTTOM_LEFT_TOP)this.dir=RIGHT,this.moveOneStep();else switch(this.color){case RED:this.blinkyMove();break;case CYAN:case ORANGE:this.inkyMove();break;case PINK:this.pinkyMove()}}},Ghost.prototype.blinkyMove=function(){this.moveToPacman(!0)},Ghost.prototype.pinkyMove=function(){this.moveToPacman(!1)},Ghost.prototype.inkyMove=function(){this.randomMove()},Ghost.prototype.moveToPacman=function(a){var c,d,e,f,b=CANVAS_WIDTH*CANVAS_HEIGHT,g=this.dir,h=b;switch(c=g!==RIGHT&&canMove(this.x,this.y,LEFT)?this.getTestDistance(LEFT,a):b,d=g!==LEFT&&canMove(this.x,this.y,RIGHT)?this.getTestDistance(RIGHT,a):b,e=g!==DOWN&&canMove(this.x,this.y,UP)?this.getTestDistance(UP,a):b,f=g!==UP&&canMove(this.x,this.y,DOWN)?this.getTestDistance(DOWN,a):b,this.dir=g,h=Math.min(Math.min(c,d),Math.min(e,f))){case c:this.dir=LEFT;break;case d:this.dir=RIGHT;break;case e:this.dir=UP;break;case f:this.dir=DOWN}this.moveOneStep()},Ghost.prototype.getTestDistance=function(a,b){var c=0;if(this.dir=a,this.moveOneStep(),b)c=Math.sqrt(Math.pow(this.x-mrPacman.x,2)+Math.pow(this.y-mrPacman.y,2));else switch(mrPacman.dir){case LEFT:c=Math.sqrt(Math.pow(this.x-(mrPacman.x-4*GRID_WIDTH),2)+Math.pow(this.y-mrPacman.y,2));break;case RIGHT:c=Math.sqrt(Math.pow(this.x-(mrPacman.x+4*GRID_WIDTH),2)+Math.pow(this.y-mrPacman.y,2));break;case UP:c=Math.sqrt(Math.pow(this.x-mrPacman.x,2)+Math.pow(this.y-(mrPacman.y-4*GRID_HEIGHT),2));break;case DOWN:c=Math.sqrt(Math.pow(this.x-mrPacman.x,2)+Math.pow(this.y-(mrPacman.y+4*GRID_HEIGHT),2));break;default:c=Math.sqrt(Math.pow(this.x-mrPacman.x,2)+Math.pow(this.y-mrPacman.y,2))}return this.turnBack(),this.moveOneStep(),c},Ghost.prototype.randomMove=function(){for(var a=parseInt(4*Math.random())+1;;){if(a!=oppositeDir(this.dir)&&canMove(this.x,this.y,a))break;a=parseInt(4*Math.random())+1}this.dir=a,this.moveOneStep()};var id=-1,CROSS_RD=-1,LEFT_ONLY=0,TOP_ONLY=1,RIGHT_ONLY=2,BOTTOM_ONLY=3,LEFT_RIGHT=4,LEFT_TOP=5,LEFT_BOTTOM=6,RIGHT_TOP=7,RIGHT_BOTTOM=8,TOP_BOTTOM=9,BOTTOM_LEFT_TOP=10,LEFT_TOP_RIGHT=11,TOP_RIGHT_BOTTOM=12,RIGHT_BOTTOM_LEFT=13,EMPTY_GRID=14,CLOSED_GRID=15;Grid.prototype.getRow=function(){return getRowIndex(this.y)},Grid.prototype.getCol=function(){return getColIndex(this.x)},Grid.prototype.hasBean=!0,Grid.prototype.toString=function(){return"Grid ("+this.x+","+this.y+") - Grid Type: "+this.gridType},Grid.prototype.draw=function(){ctx.fillStyle=BG_COLOR,ctx.fillRect(this.x,this.y,GRID_WIDTH,GRID_HEIGHT);var a=this.gridType;if(void 0===a||a===EMPTY_GRID)return void this.drawBean();switch(a){case LEFT_ONLY:this.addLeftEdge();break;case RIGHT_ONLY:this.addRightEdge();break;case TOP_ONLY:this.addTopEdge();break;case BOTTOM_ONLY:this.addBottomEdge();break;case LEFT_RIGHT:this.addLeftEdge(),this.addRightEdge();break;case LEFT_TOP:this.addLeftEdge(),this.addTopEdge();break;case LEFT_BOTTOM:this.addLeftEdge(),this.addBottomEdge();break;case RIGHT_TOP:this.addRightEdge(),this.addTopEdge();break;case RIGHT_BOTTOM:this.addRightEdge(),this.addBottomEdge();break;case TOP_BOTTOM:this.addTopEdge(),this.addBottomEdge();break;case CROSS_RD:this.makeCrossRoad();break;case LEFT_TOP_RIGHT:this.addLeftEdge(),this.addTopEdge(),this.addRightEdge();break;case TOP_RIGHT_BOTTOM:this.addTopEdge(),this.addRightEdge(),this.addBottomEdge();break;case RIGHT_BOTTOM_LEFT:this.addRightEdge(),this.addBottomEdge(),this.addLeftEdge();break;case BOTTOM_LEFT_TOP:this.addBottomEdge(),this.addLeftEdge(),this.addTopEdge();break;case CLOSED_GRID:this.addLeftEdge(),this.addTopEdge(),this.addBottomEdge(),this.addRightEdge()}this.drawBean()},Grid.prototype.addLeftEdge=function(){ctx.fillStyle=BORDER_COLOR,ctx.fillRect(this.x,this.y,WALL_WIDTH,GRID_HEIGHT)},Grid.prototype.addRightEdge=function(){ctx.fillStyle=BORDER_COLOR,ctx.fillRect(this.x+GRID_WIDTH-WALL_WIDTH,this.y,WALL_WIDTH,GRID_HEIGHT)},Grid.prototype.addTopEdge=function(){ctx.fillStyle=BORDER_COLOR,ctx.fillRect(this.x,this.y,GRID_WIDTH,WALL_WIDTH)},Grid.prototype.addBottomEdge=function(){ctx.fillStyle=BORDER_COLOR,ctx.fillRect(this.x,this.y+GRID_HEIGHT-WALL_WIDTH,GRID_WIDTH,WALL_WIDTH)},Grid.prototype.makeCrossRoad=function(){ctx.fillStyle=BORDER_COLOR,ctx.fillRect(this.x,this.y,WALL_WIDTH,WALL_WIDTH),ctx.fillRect(this.x+GRID_WIDTH-WALL_WIDTH,this.y,WALL_WIDTH,WALL_WIDTH),ctx.fillRect(this.x,this.y+GRID_HEIGHT-WALL_WIDTH,WALL_WIDTH,WALL_WIDTH),ctx.fillRect(this.x+GRID_WIDTH-WALL_WIDTH,this.y+GRID_HEIGHT-WALL_WIDTH,WALL_WIDTH,WALL_WIDTH)},Grid.prototype.drawBean=function(){var a=this.beanType,b=this.x+GRID_WIDTH/2,c=this.y+GRID_HEIGHT/2;if(ctx.fillStyle=BEAN_COLOR,void 0!==a)if(a===NORMAL_BEAN)circle(ctx,b,c,NORMAL_BEAN_RADIUS);else{if(a!==POWER_BEAN)return;circle(ctx,b,c,POWER_BEAN_RADIUS)}};var canvasID="capito",CANVAS_WIDTH=510,CANVAS_HEIGHT=510,canvas=document.getElementById(canvasID),ctx=canvas.getContext("2d"),GRID_WIDTH=30,GRID_HEIGHT=30,WALL_WIDTH=3,numRows=CANVAS_WIDTH/GRID_HEIGHT,numCols=CANVAS_HEIGHT/GRID_WIDTH,BG_COLOR="#F7F7F7",BORDER_COLOR="gray",BEAN_COLOR="#ffb400",PACMAN_COLOR="#22A7F0",RED="#FA2A00",PINK="#ff9cce",CYAN="#1ABC9C",ORANGE="#ffb847",WEAK_COLOR="#0031ff",BLINKING_COLOR="#000000",NORMAL_BEAN_RADIUS=2,POWER_BEAN_RADIUS=5,PACMAN_RADIUS=9,GHOST_RADIUS=9,UP=1,DOWN=2,LEFT=3,RIGHT=4,intervalId,restartTimer=0,timerDelay=80,speed=5,score=0,lives=[],MAX_LIFE=3,life=MAX_LIFE,weakBonus=200,MAX_BEANS=136,beansLeft=MAX_BEANS,weakCounter,WEAK_DURATION=1e4/timerDelay,NORMAL_BEAN=1,POWER_BEAN=2,welcomePacman,welcomeBlinky,welcomeInky,mrPacman,blinky,inky,pinky,clyde,ghosts,gameOn=!1,gamePaused=!1,maze=new Array(CANVAS_HEIGHT/GRID_HEIGHT),mazeContent=[[LEFT_TOP,TOP_BOTTOM,TOP_BOTTOM,TOP_ONLY,TOP_BOTTOM,TOP_BOTTOM,TOP_BOTTOM,RIGHT_TOP,LEFT_TOP,TOP_ONLY,TOP_ONLY,TOP_ONLY,TOP_ONLY,TOP_ONLY,TOP_ONLY,TOP_ONLY,RIGHT_TOP],[LEFT_RIGHT,BOTTOM_LEFT_TOP,RIGHT_TOP,LEFT_RIGHT,LEFT_TOP,TOP_BOTTOM,TOP_RIGHT_BOTTOM,LEFT_RIGHT,LEFT_BOTTOM,BOTTOM_ONLY,BOTTOM_ONLY,BOTTOM_ONLY,BOTTOM_ONLY,BOTTOM_ONLY,EMPTY_GRID,EMPTY_GRID,RIGHT_ONLY],[LEFT_BOTTOM,RIGHT_TOP,LEFT_RIGHT,LEFT_RIGHT,LEFT_RIGHT,BOTTOM_LEFT_TOP,TOP_BOTTOM,EMPTY_GRID,TOP_BOTTOM,TOP_BOTTOM,TOP_BOTTOM,TOP_BOTTOM,TOP_BOTTOM,RIGHT_TOP,LEFT_ONLY,EMPTY_GRID,RIGHT_ONLY],[CLOSED_GRID,LEFT_RIGHT,LEFT_RIGHT,LEFT_RIGHT,LEFT_BOTTOM,TOP_BOTTOM,RIGHT_TOP,LEFT_RIGHT,BOTTOM_LEFT_TOP,TOP_BOTTOM,TOP_BOTTOM,TOP_BOTTOM,TOP_RIGHT_BOTTOM,LEFT_RIGHT,LEFT_ONLY,EMPTY_GRID,RIGHT_ONLY],[LEFT_TOP,RIGHT_BOTTOM,LEFT_RIGHT,LEFT_BOTTOM,TOP_ONLY,TOP_RIGHT_BOTTOM,LEFT_RIGHT,LEFT_ONLY,TOP_BOTTOM,TOP_BOTTOM,TOP_BOTTOM,TOP_ONLY,TOP_BOTTOM,RIGHT_BOTTOM,LEFT_ONLY,EMPTY_GRID,RIGHT_ONLY],[LEFT_RIGHT,BOTTOM_LEFT_TOP,BOTTOM_ONLY,TOP_RIGHT_BOTTOM,LEFT_RIGHT,BOTTOM_LEFT_TOP,RIGHT_BOTTOM,LEFT_RIGHT,LEFT_TOP,TOP_BOTTOM,RIGHT_TOP,LEFT_RIGHT,BOTTOM_LEFT_TOP,TOP_BOTTOM,BOTTOM_ONLY,BOTTOM_ONLY,RIGHT_BOTTOM],[LEFT_ONLY,TOP_BOTTOM,TOP_BOTTOM,TOP_BOTTOM,BOTTOM_ONLY,TOP_BOTTOM,TOP_BOTTOM,RIGHT_ONLY,LEFT_RIGHT,LEFT_TOP_RIGHT,LEFT_RIGHT,LEFT_ONLY,TOP_BOTTOM,TOP_BOTTOM,TOP_BOTTOM,TOP_BOTTOM,RIGHT_TOP],[LEFT_RIGHT,BOTTOM_LEFT_TOP,TOP_BOTTOM,TOP_BOTTOM,TOP_BOTTOM,TOP_BOTTOM,TOP_RIGHT_BOTTOM,LEFT_RIGHT,LEFT_RIGHT,LEFT_RIGHT,LEFT_RIGHT,LEFT_RIGHT,BOTTOM_LEFT_TOP,TOP_BOTTOM,TOP_BOTTOM,TOP_RIGHT_BOTTOM,LEFT_RIGHT],[LEFT_BOTTOM,TOP_BOTTOM,TOP_BOTTOM,TOP_BOTTOM,TOP_ONLY,TOP_BOTTOM,TOP_BOTTOM,RIGHT_ONLY,LEFT_RIGHT,LEFT_RIGHT,LEFT_RIGHT,LEFT_ONLY,TOP_BOTTOM,TOP_BOTTOM,TOP_BOTTOM,TOP_BOTTOM,RIGHT_ONLY],[LEFT_TOP,TOP_ONLY,TOP_ONLY,RIGHT_TOP,LEFT_RIGHT,BOTTOM_LEFT_TOP,TOP_RIGHT_BOTTOM,LEFT_RIGHT,RIGHT_BOTTOM_LEFT,LEFT_RIGHT,RIGHT_BOTTOM_LEFT,LEFT_RIGHT,BOTTOM_LEFT_TOP,TOP_BOTTOM,TOP_BOTTOM,TOP_RIGHT_BOTTOM,LEFT_RIGHT],[LEFT_ONLY,EMPTY_GRID,EMPTY_GRID,RIGHT_ONLY,LEFT_ONLY,TOP_BOTTOM,TOP_BOTTOM,BOTTOM_ONLY,TOP_ONLY,BOTTOM_ONLY,TOP_BOTTOM,BOTTOM_ONLY,TOP_ONLY,TOP_BOTTOM,TOP_BOTTOM,TOP_BOTTOM,RIGHT_ONLY],[LEFT_ONLY,EMPTY_GRID,EMPTY_GRID,RIGHT_ONLY,LEFT_RIGHT,BOTTOM_LEFT_TOP,TOP_BOTTOM,RIGHT_TOP,LEFT_RIGHT,BOTTOM_LEFT_TOP,TOP_BOTTOM,RIGHT_TOP,LEFT_RIGHT,BOTTOM_LEFT_TOP,TOP_BOTTOM,RIGHT_TOP,LEFT_RIGHT],[LEFT_ONLY,EMPTY_GRID,EMPTY_GRID,RIGHT_ONLY,LEFT_ONLY,TOP_BOTTOM,TOP_RIGHT_BOTTOM,LEFT_RIGHT,LEFT_ONLY,TOP_BOTTOM,TOP_RIGHT_BOTTOM,LEFT_RIGHT,LEFT_ONLY,TOP_BOTTOM,RIGHT_TOP,LEFT_RIGHT,LEFT_RIGHT],[LEFT_ONLY,EMPTY_GRID,EMPTY_GRID,RIGHT_ONLY,LEFT_RIGHT,LEFT_TOP,TOP_BOTTOM,RIGHT_BOTTOM,LEFT_RIGHT,BOTTOM_LEFT_TOP,TOP_BOTTOM,RIGHT_ONLY,LEFT_RIGHT,LEFT_TOP_RIGHT,LEFT_RIGHT,LEFT_RIGHT,LEFT_RIGHT],[LEFT_ONLY,EMPTY_GRID,EMPTY_GRID,RIGHT_ONLY,LEFT_RIGHT,LEFT_RIGHT,BOTTOM_LEFT_TOP,TOP_BOTTOM,EMPTY_GRID,TOP_BOTTOM,TOP_RIGHT_BOTTOM,LEFT_RIGHT,LEFT_RIGHT,LEFT_RIGHT,LEFT_RIGHT,LEFT_RIGHT,LEFT_RIGHT],[LEFT_ONLY,EMPTY_GRID,EMPTY_GRID,RIGHT_ONLY,LEFT_RIGHT,LEFT_BOTTOM,TOP_BOTTOM,TOP_RIGHT_BOTTOM,LEFT_RIGHT,BOTTOM_LEFT_TOP,TOP_BOTTOM,RIGHT_BOTTOM,LEFT_RIGHT,LEFT_RIGHT,LEFT_RIGHT,RIGHT_BOTTOM_LEFT,LEFT_RIGHT],[LEFT_BOTTOM,BOTTOM_ONLY,BOTTOM_ONLY,RIGHT_BOTTOM,LEFT_BOTTOM,TOP_BOTTOM,TOP_BOTTOM,TOP_BOTTOM,BOTTOM_ONLY,TOP_BOTTOM,TOP_BOTTOM,TOP_BOTTOM,RIGHT_BOTTOM,RIGHT_BOTTOM_LEFT,LEFT_BOTTOM,TOP_BOTTOM,RIGHT_BOTTOM]],staticGrids=[],staticGridsIndex=0,pacmanStartLoc=[4,9],noBean=[pacmanStartLoc,[5,12],[5,13],[5,3],[9,5],[9,6],[1,1],[5,1],[3,0],[2,4],[4,6],[5,6],[5,5],[12,7],[14,5],[12,11],[14,11]],noBeanIndex=noBean.length,powerBeans=[[0,0],[2,13],[16,4],[16,16],[2,5],[14,10]],ghostHouse=[],ghostHouseIndex=0;initFields(),initCanvas(CANVAS_WIDTH,CANVAS_HEIGHT),canvas.addEventListener("keydown",onKeyDown,!1),canvas.setAttribute("tabindex","0"),canvas.focus(),welcomeScreen();